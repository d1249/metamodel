# Формат YAML для описания метамодели банка

Документ фиксирует целевую структуру YAML-файла, применяемого для описания
метамодели банка BANK. Формат рассчитан на расширяемость, возможность
хранения типизированных связей, перечня сущностей и их атрибутов.

## 1. Общая структура файла

```yaml
meta:
  version: 1
  bank_code: "BANK"
  model_name: "enterprise_metamodel"
  last_updated: "2025-11-16"
  locale: "ru-RU"            # необязательно, но рекомендуется

dictionaries:
  metamodel_levels: [...]      # справочники, доступные модели

entity_kinds:                  # перечень типов сущностей
  - id: ...
    name: ...
    name_ru: ...
    metamodel_level: ...
    category: ...
    description: ...          # многострочный текст допускается
    rules: |-                 # набор бизнес-правил в формате списка
      - ...
    attributes: []            # опционально; см. раздел 3
    tags: []                  # свободная классификация (опционально)

relation_kinds:               # перечень типов связей
  - id: ...
    name: ...
    from_kind: ...
    to_kind: ...
    metamodel_level: ...
    category: ...
    direction: directed|undirected
    description: ...
    constraints: []           # опционально; правила использования
```

## 2. Требования к ключевым разделам

### 2.1. `meta`
- Обязательные поля: `version`, `bank_code`, `model_name`, `last_updated`.
- Значения фиксируют версионность файла и позволяют потребителям быстро
  сверять актуальность данных.
- Дополнительные поля (`locale`, `author`, `change_comment`) допускаются без
  изменения схемы благодаря словарной природе YAML.

### 2.2. `dictionaries`
- Содержит именованные списки справочных значений (уровни метамодели,
  классификаторы чувствительности, статусы и т.д.).
- Каждый элемент справочника обязан иметь `id` и `name`. Дополнительные поля
  (`order`, `description`, `metadata`) разрешены и не требуют модификации
  схемы.

### 2.3. `entity_kinds`
- Список описаний типов сущностей метамодели.
- Обязательные поля: `id`, `name`, `metamodel_level`, `category`.
- `description` и `rules` рекомендуются, но не обязательны.
- Поле `attributes` описывает опциональные атрибуты сущности. Каждый атрибут
  обязан иметь `id`, `name`, `metamodel_level`; `description` и `properties`
  (произвольный словарь) опциональны.
- `properties` на уровне сущности позволяют задавать произвольные дополнительные
  сведения (например, `lifecycle: stable`).

### 2.4. `relation_kinds`
- Описывает возможные связи между типами сущностей.
- Обязательные поля: `id`, `name`, `from_kind`, `to_kind`, `metamodel_level`,
  `category`, `direction`.
- Дополнительно допускаются поля `description`, `rules`, `cardinality`,
  `properties`. Это обеспечивает расширяемость без пересмотра схемы.

## 3. Атрибуты и их свойства

Атрибуты сущности описываются следующей структурой:

```yaml
attributes:
  - id: business_capability.maturity_level
    name: "Уровень зрелости"
    metamodel_level: business
    description: "..."
    properties:
      data_type: string
      allowed_values: ["initial", "managed", "optimized"]
```

Требования:
- `metamodel_level` обязателен для каждого атрибута.
- Свойства (`properties`) задаются свободно — как словарь ключ/значение.
- Текстовое описание (`description`) рекомендуется, но формально опционально.

## 4. Правила ведения файла

1. **Единый источник правды** — YAML-файл хранится в VCS и изменяется только
   через pull request.
2. **Версионность** — при каждом изменении содержания требуется обновлять
   поле `meta.last_updated`; поле `meta.version` повышается при изменениях
   структуры или семантики.
3. **Нотация идентификаторов** — `id` только в `snake_case`, уникален в пределах
   соответствующего списка. Атрибуты рекомендуют использовать нотацию
   `<entity>.<attribute>`.
4. **Документация правил** — если сущность или связь имеет особые правила,
   они фиксируются в поле `rules` в виде списка маркеров.
5. **Расширяемость** — допускается добавление дополнительных полей в любую
   сущность или связь при условии, что эти поля не конфликтуют с текущей
   схемой и описаны в документации модели.
6. **Ссылочная целостность** — значения `from_kind`/`to_kind` в `relation_kinds`
   должны ссылаться на существующие `entity_kinds`.

## 5. Схема и проверка

- Формальная схема задана в файле `schema/metamodel.schema.yaml` (JSON Schema).
- Проверка осуществляется любым валидатором JSON Schema, понимающим YAML.
- При расширении структуры рекомендуется дополнять схему новыми свойствами.

## 6. Файл со значениями

- Экземпляр модели хранится в `data/enterprise_metamodel.yaml`.
- Файл соответствует описанному формату и проходит проверку схемой.
- Новые банки или модели добавляются в отдельные файлы внутри каталога `data/`.
